<!DOCTYPE html>
<html class="wide wow-animation" lang="en">
<head> 
    {% load static %}{% load humanize %}
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="icon" href="{% static 'images/favicon.ico' %}" type="image/x-icon">
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Poppins:300,400,500,600,700,900">
    <link rel="stylesheet" href="{% static 'css/bootstrap.css' %}">
    <link rel="stylesheet" href="{% static 'css/fonts.css' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <style>
        .ie-panel { 
            display: none;
            background: #212121;
            padding: 10px 0;
            box-shadow: 3px 3px 5px 0 rgba(0,0,0,.3);
            clear: both;
            text-align: center;
            position: relative;
            z-index: 1;
        }
        html.ie-10 .ie-panel, html.lt-ie-10 .ie-panel {
            display: block;
        }
    </style>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shared Builds</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 0;
        }

        .container {
            width: 60%;
            margin: 30px auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
        }

        h2 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }

        .build-list {
            list-style: none;
            padding: 0;
        }

        .build-item {
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .profile-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .profile-pic {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
        }

        .username {
            font-weight: bold;
            color: #3498db;
            font-size: 1.2em;
        }

        .build-name {
            font-size: 1.5em;
            font-weight: bold;
            margin: 10px 0;
            color: #333;
        }

        .build-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
        }

        .build-details .item {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #fff;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .build-details img {
            width: 50px;
            height: 50px;
            object-fit: contain;
        }

        .total-price {
            font-size: 1.2em;
            font-weight: bold;
            color: #e74c3c;
            text-align: right;
            margin-top: 10px;
        }

        .view-button {
            display: block;
            text-align: center;
            background-color: #3498db;
            color: white;
            padding: 12px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            margin-top: 15px;
            transition: background 0.3s;
        }

        .view-button:hover {
            background-color: #2980b9;
        }

        /* SHARE BUTTON */
        .share-button {
            background-color: #3498db;
            color: white;
            padding: 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            width: 100%;
            margin-top: 10px;
            display: block;
            text-align: center;
        }

        .share-button:hover {
            background-color: #2980b9;
        }

        /* SHARE OVERLAY */
        .share-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .share-content {
            background: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            width: 350px;
            position: relative;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: #777;
        }

        .close-btn:hover {
            color: #333;
        }

        .share-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 20px;
        }

        .share-buttons button {
            padding: 12px;
            border: none;
            border-radius: 6px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: opacity 0.3s;
        }

        .share-buttons button:hover {
            opacity: 0.9;
        }

        .whatsapp { background: #25D366; }
        .facebook { background: #1877F2; }
        .twitter { background: #1DA1F2; }
        .copy-link { background: #555; }

        .debug-url {
            font-size: 12px;
            color: #666;
            word-break: break-all;
            margin: 10px 0;
            padding: 8px;
            background: #f5f5f5;
            border-radius: 4px;
        }
        .filter-buttons {
            position: fixed;
            top: 100px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .filter-buttons button {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            background-color: #3498db;
            color: white;
            cursor: pointer;
        }

        .filter-buttons button:hover {
            background-color: #2980b9;
        }
    </style>
</head>
<body>
    <div class="ie-panel"><a href="http://windows.microsoft.com/en-US/internet-explorer/"><img src="{% static 'images/ie8-panel/warning_bar_0000_us.jpg' %}" height="42" width="820" alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today."></a></div>
    <div class="preloader">
        <div class="preloader-body">
            <div class="cssload-container">
                <div class="cssload-speeding-wheel"></div>
            </div>
            <p>Loading...</p>
        </div>
    </div>
    <div class="page">
<header class="section page-header">
    <div class="rd-navbar-wrap">
        <nav class="rd-navbar rd-navbar-wide" data-layout="rd-navbar-fixed" data-sm-layout="rd-navbar-fixed" data-md-layout="rd-navbar-fixed" data-md-device-layout="rd-navbar-fixed" data-lg-layout="rd-navbar-static" data-lg-device-layout="rd-navbar-static" data-xl-layout="rd-navbar-static" data-xl-device-layout="rd-navbar-static" data-lg-stick-up-offset="46px" data-xl-stick-up-offset="46px" data-xxl-stick-up-offset="46px" data-lg-stick-up="true" data-xl-stick-up="true" data-xxl-stick-up="true">
            <div class="rd-navbar-main-outer">
                <div class="rd-navbar-main">
                    <div class="rd-navbar-panel">
                        <button class="rd-navbar-toggle" data-rd-navbar-toggle=".rd-navbar-nav-wrap"><span></span></button>
                        <div class="rd-navbar-brand">
                            <a class="brand" href="{% url 'index' %}">
                                <img class="brand-logo-dark" src="{% static 'images/logo-default-261x72.png' %}" alt="" width="261" height="72" srcset="{% static 'images/logo-default-261x72.png' %} 2x"/>
                                <img class="brand-logo-light" src="{% static 'images/logo-inverse-133x45.png' %}" alt="" width="133" height="45" srcset="{% static 'images/logo-inverse-266x90.png' %} 2x"/>
                            </a>
                        </div>
                    </div>

                    <div class="rd-navbar-nav-wrap">
                        <ul class="rd-navbar-nav">
                            <li class="rd-nav-item"><a class="rd-nav-link" href="{% url 'pcbuild' %}">Builder</a></li>
                            <li class="rd-nav-item"><a class="rd-nav-link" href='/parts/'>PC Parts</a></li>
                            <li class="rd-nav-item"><a class="rd-nav-link" href="{% url 'build_help' %}">Build Help</a></li>
                            <li class="rd-nav-item"><a class="rd-nav-link" href="{% url 'contacts' %}">Contacts</a></li>

                            {% if user.is_authenticated %}
                            <li class="rd-nav-item" style="position: relative;">
                                <div class="user-info-box" style="display: flex; align-items: center; justify-content: center; cursor: pointer;" onclick="toggleDropdown()">
                                    {% if request.user.profile.profile_picture %}
                                        <img src="{{ request.user.profile.profile_picture.url }}" alt="Profile Picture" style="width:50px;height:50px;border-radius:50%; margin-right: 10px; margin-top: 15px;" />
                                    {% else %}
                                        <img src="{% static 'images/default-profile.png' %}" alt="Profile Picture" style="width:50px;height:50px;border-radius:50%; margin-right: 10px; margin-top: 15px;" />
                                    {% endif %}
                                    <span style="margin-top: 15px;">{{ user.username }}</span>
                                </div>
                                <div id="user-dropdown" class="dropdown-menu" style="display: none; position: absolute; top: 100%; right: 0; background: #fff; border: 1px solid #ddd; padding: 10px; width: 150px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);">
                                    <a href="{% url 'profile' %}" class="dropdown-item">Manage Profile</a>
                        
                                    {% if user.is_staff %}
                                        <a href="{% url 'staff_dashboard' %}" class="dropdown-item" style="color: #28a745; font-weight: bold;">Staff Panel</a>
                                    {% endif %}
                        
                                    <form method="post" action="{% url 'logout' %}" class="dropdown-item">
                                        {% csrf_token %}
                                        <button type="submit" style="background: none; border: none; padding: 0; color: #007bff;">Logout</button>
                                    </form>
                                </div>
                            </li>
                        {% else %}
                            <li class="rd-nav-item"><a class="rd-nav-link" href="{% url 'login' %}">Login</a></li>
                            <li class="rd-nav-item"><a class="rd-nav-link" href="{% url 'signup' %}">Sign up</a></li>
                        {% endif %}
                        
                        <script>
                        function toggleDropdown() {
                            var dropdown = document.getElementById("user-dropdown");
                            dropdown.style.display = (dropdown.style.display === "none" || dropdown.style.display === "") ? "block" : "none";
                        }
                        
                        // Close dropdown when clicking outside
                        document.addEventListener("click", function(event) {
                            var dropdown = document.getElementById("user-dropdown");
                            var userInfoBox = document.querySelector(".user-info-box");
                        
                            if (!userInfoBox.contains(event.target) && dropdown.style.display === "block") {
                                dropdown.style.display = "none";
                            }
                        });
                        </script>
                        </ul>
                    </div>
                </div>
            </div>
        </nav>
    </div>
</header>
<div class="filter-buttons">
    <button onclick="sortBuilds('recent')">Recent Builds</button>
    <button onclick="sortBuilds('oldest')">Oldest Builds</button>
</div>

<div class="container">
        <center><h3>All Shared Builds</h3></center>
        <ul class="build-list" id="build-list">
            {% if shared_builds %}
                {% for build in shared_builds %}
                    <li class="build-item" data-created-at="{{ build.created_at|date:'U' }}">
                        <div class="profile-section">
                            <img src="{{ build.user.profile.profile_picture.url }}" alt="Profile Picture" class="profile-pic">
                            <span class="username">{{ build.user.username }}</span>
                        </div>
                        <div class="build-name">{{ build.name }}</div>
                        <div>{{ build.created_at|date:"F j, Y, g:i a" }}</div>
                        <div class="build-details">
                            <div class="item"><img src="{{ build.cpu.image.url }}" alt="CPU"> <span><strong>CPU:</strong> {{ build.cpu.name }}</span></div>
                            <div class="item"><img src="{{ build.gpu.image.url }}" alt="GPU"> <span><strong>GPU:</strong> {{ build.gpu.name }}</span></div>
                            <div class="item"><img src="{{ build.motherboard.image.url }}" alt="Motherboard"> <span><strong>Motherboard:</strong> {{ build.motherboard.name }}</span></div>
                            <div class="item"><img src="{{ build.ram.image.url }}" alt="RAM"> <span><strong>RAM:</strong> {{ build.ram.brand }} {{ build.ram.model }} ({{ build.ram.capacity }}GB)</span></div>
                            <div class="item"><img src="{{ build.psu.image.url }}" alt="PSU"> <span><strong>PSU:</strong> {{ build.psu.name }}</span></div>
                            <div class="item"><img src="{{ build.ssd.image.url }}" alt="SSD"> <span><strong>SSD:</strong> {{ build.ssd.name }}</span></div>
                        </div>
                        <div class="total-price">Total Price: â‚¹{{ build.cpu.price|add:build.gpu.price|add:build.motherboard.price|add:build.ram.price|add:build.ssd.price|add:build.psu.price |intcomma}}</div>
                        <a href="{% url 'shared_build_detail' build.id %}" class="view-button">View Build</a>
                        <button class="view-button" onclick="openShareOverlay('{{ build.id }}')">ðŸ”— Share</button>
                        
                        <div id="share-overlay-{{ build.id }}" class="share-overlay">
                            <div class="share-content">
                                <span class="close-btn" onclick="closeShareOverlay('{{ build.id }}')">&times;</span>
                                <h5>Share this Build</h5>
                                <div class="debug-url">{{ request.scheme }}://{{ request.get_host }}{% url 'shared_build_detail' build.id %}</div>
                                <center><div id="qrcode"></div></center>
                            
                                <div class="share-buttons">
                                    <button class="whatsapp" onclick="shareOnWhatsApp('{{ build.id }}')">
                                        <span>WhatsApp</span>
                                    </button>
                                    <button class="facebook" onclick="shareOnFacebook('{{ build.id }}')">
                                        <span>Facebook</span>
                                    </button>
                                    <button class="twitter" onclick="shareOnTwitter('{{ build.id }}')">
                                        <span>Twitter</span>
                                    </button>
                                    <button class="copy-link" onclick="copyBuildLink('{{ build.id }}')">
                                        <span>Copy Link</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </li>
                {% endfor %}
            {% else %}
                <p style="text-align: center; color: #777; font-size: 1.2em;">No shared builds available.</p>
            {% endif %}
        </ul>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Get the URL from the debug div
            var url = document.querySelector(".debug-url").textContent.trim();
            
            // Generate the QR Code
            new QRCode(document.getElementById("qrcode"), {
                text: url,  // Use the extracted URL
                width: 128,
                height: 128
            });
        });

        function openShareOverlay(buildId) {
            document.getElementById("share-overlay-" + buildId).style.display = "flex";
        }

        function closeShareOverlay(buildId) {
            document.getElementById("share-overlay-" + buildId).style.display = "none";

            // Clear the QR code data without affecting other functions
            document.getElementById("qrcode-" + buildId).innerHTML = "";
        }

        function getBuildUrl(buildId) {
            return window.location.origin + "{% url 'shared_build_detail' 0 %}".replace('0', buildId);
        }

        function shareOnWhatsApp(buildId) {
            const url = getBuildUrl(buildId);
            window.open(`https://api.whatsapp.com/send?text=Check out this PC build: ${encodeURIComponent(url)}`, '_blank');
        }

        function shareOnFacebook(buildId) {
            const url = getBuildUrl(buildId);
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`, '_blank');
        }

        function shareOnTwitter(buildId) {
            const url = getBuildUrl(buildId);
            window.open(`https://twitter.com/intent/tweet?url=${encodeURIComponent(url)}&text=Check out this PC build`, '_blank');
        }

        function copyBuildLink(buildId) {
            const url = getBuildUrl(buildId);
            navigator.clipboard.writeText(url).then(() => {
                alert("Link copied to clipboard!");
            }).catch(err => {
                console.error("Failed to copy: ", err);
                alert("Failed to copy link. Please try again.");
            });
        }

        // Close overlay when clicking outside the content
        document.addEventListener('click', function(event) {
            if (event.target.classList.contains('share-overlay')) {
                event.target.style.display = 'none';
            }
        });
        function sortBuilds(order) {
            const buildList = document.getElementById('build-list');
            const buildItems = Array.from(buildList.children);

            buildItems.sort((a, b) => {
                const dateA = parseInt(a.dataset.createdAt);
                const dateB = parseInt(b.dataset.createdAt);

                return order === 'recent' ? dateB - dateA : dateA - dateB;
            });

            buildItems.forEach(item => buildList.appendChild(item));
        }
    </script>
        <script src="{% static 'js/core.min.js' %}"></script>
        <script src="{% static 'js/script.js' %}"></script> 
</body>
</html>